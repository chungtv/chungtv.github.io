<!DOCTYPE html>
<html lang="en">
  
  <head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Tạo file Batch đồng bộ 2 thư mục theo ngày</title>
  <meta name="author" content="Chung Trịnh" />  
  
  <link rel="canonical" href="/work/tips%20and%20tricks/2012/04/05/tao-file-batch-dong-bo-2-thu-muc-theo-ngay.html">
  <link href="http://chungtrinh.com/feed.xml" type="application/atom+xml" rel="alternate" title="Chung Trịnh's Blog Feed">
  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
   <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css" /> 
  
   <link rel="stylesheet" href="/css/bootstrap.min.css" /><link rel="stylesheet" href="/css/main.css" /> 
  
   <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic" /><link rel="stylesheet" href="//fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800" /> 
  
  
  
  
  
  
  <!-- Twitter Cards -->
  <meta name="twitter:card" content="summary">
  <meta name="twitter:image" content="http://chungtrinh.com/img/logo.png">
  <meta name="twitter:title" content="Tạo file Batch đồng bộ 2 thư mục theo ngày">
  <meta name="twitter:description" content="Business Software Developer and Bloger!">
  <meta name="twitter:creator" content="@trinhvanchung">
  <!-- Open Graph -->
  <meta property="og:locale" content="en_US">
  <meta property="og:type" content="article">
  <meta property="og:title" content="Tạo file Batch đồng bộ 2 thư mục theo ngày">
  <meta property="og:description" content="Business Software Developer and Bloger!">
  <meta property="og:url" content="http://chungtrinh.com/work/tips%20and%20tricks/2012/04/05/tao-file-batch-dong-bo-2-thu-muc-theo-ngay.html/" />
    
  <meta property="og:site_name" content="Chung Trịnh's Blog">
  <meta property="og:image" content="http://chungtrinh.com/img/logo.png" />
  <!-- Icons -->
  <link rel="shortcut icon" href="http://chungtrinh.com/img/favicon.ico" type="image/x-icon" />
  <link rel="apple-touch-icon" sizes="57x57" href="http://chungtrinh.com/img/apple-touch-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="http://chungtrinh.com/img/apple-touch-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="http://chungtrinh.com/img/apple-touch-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="http://chungtrinh.com/img/apple-touch-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="http://chungtrinh.com/img/apple-touch-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="http://chungtrinh.com/img/apple-touch-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="http://chungtrinh.com/img/apple-touch-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="http://chungtrinh.com/img/apple-touch-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="http://chungtrinh.com/img/apple-touch-icon-180x180.png">
  <link rel="icon" type="image/png" href="http://chungtrinh.com/img/favicon-16x16.png" sizes="16x16">
  <link rel="icon" type="image/png" href="http://chungtrinh.com/img/favicon-32x32.png" sizes="32x32">
  <link rel="icon" type="image/png" href="http://chungtrinh.com/img/favicon-96x96.png" sizes="96x96">
  <link rel="icon" type="image/png" href="http://chungtrinh.com/img/android-chrome-192x192.png" sizes="192x192">
  <meta name="msapplication-square70x70logo" content="http://chungtrinh.com/img/smalltile.png" />
  <meta name="msapplication-square150x150logo" content="http://chungtrinh.com/img/mediumtile.png" />
  <meta name="msapplication-wide310x150logo" content="http://chungtrinh.com/img/widetile.png" />
  <meta name="msapplication-square310x310logo" content="http://chungtrinh.com/img/largetile.png" />
</head>


  <body>
  
    <nav class="navbar navbar-default navbar-fixed-top navbar-custom">
  <div class="container-fluid">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#main-navbar">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="http://chungtrinh.com/">Chung Trịnh's Blog</a>
    </div>
    <div class="collapse navbar-collapse" id="main-navbar">
      <ul class="nav navbar-nav navbar-right">
           
        
          <li>
            
            





<a href="/">Home</a>

          </li>
        
        
        
          <li class="navlinks-container">
            <a class="navlinks-parent" href="javascript:void(0)">Categories</a>
            <div class="navlinks-children">
              
                
                  
            





<a href="/categories">All Categories</a>

                
              
                
                  
            





<a href="/categories#work">Works</a>

                
              
                
                  
            





<a href="/categories#life">Life</a>

                
              
                
                  
            





<a href="/categories#tutorials">Tutorials</a>

                
              
                
                  
            





<a href="/categories#tips-and-tricks">Tips & tricks</a>

                
              
            </div>
          </li>
        
        
        
          <li>
            
            





<a href="/tags">Tags</a>

          </li>
        
        
        
          <li>
            
            





<a href="/pages/tools">Tools</a>

          </li>
        
        
        
          <li>
            
            





<a href="/about">About</a>

          </li>
        
        
      </ul>
    </div>
	
	<div class="avatar-container">
	  <div class="avatar-img-border">
	    <a href="http://chungtrinh.com ">
	      <img class="avatar-img" src="/img/avatar.jpg" />
		</a>
	  </div>
	</div>
	
  </div>
</nav>


    <!-- TODO this file has become a mess, refactor it -->





<header class="header-section ">

<div class="intro-header no-img">
  <div class="container">
    <div class="row">
      <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
        <div class="post-heading">
          <h1>Tạo file Batch đồng bộ 2 thư mục theo ngày</h1>
		  
		  
		  
		  <span class="post-meta">Posted on April 5, 2012. Tagged:  <a href="/tags#batch"> • Batch</a><a href="/tags#sync"> • Sync</a></span>
		  
        </div>
      </div>
    </div>
  </div>
</div>
</header>




<div class="container">
  <article>
    <div class="row">
      <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
      <p>Trong quá trình triển khai phần mềm, việc sửa đổi chương trình theo yêu cầu người dùng là không tránh khỏi. Thường đội triển khai sẽ hiệu chỉnh chương trình trực tiếp trên server và client sẽ update xuống.</p>

<p>Việc update từ server xuống client cũng có nhiều giải pháp. Sau đây là giải pháp mình đang sử dụng:</p>

<p>Giải pháp của mình là sử dụng 1 <a href="http://en.wikipedia.org/wiki/Batch_file">batch file window</a> để thực hiện việc này. Batch file này làm nhiệm vụ copy file từ server về client và chỉ copy những file nào có ngày modify &gt;= ngày update gần nhất. Để xác định ngày update gần nhất mình dùng 1 file text lưu giá trị ngày update.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>	:: Author | Chungtv
	:: Purpose | Synchronize files from server to client
	@echo off
	:: Lay ngay hien tai
	call :GetDate y m d
	<span class="nb">echo </span>TODAY: %m%-%d%-%y%
	<span class="nb">set </span><span class="nv">ud</span><span class="o">=</span>%m%-%d%-%y%
	:: Neu ton tai file update thi gan ngay update la ngay luu trong file
	<span class="k">if </span>exist <span class="s2">"D:</span><span class="se">\A</span><span class="s2">siasoft</span><span class="se">\A</span><span class="s2">E81</span><span class="se">\L</span><span class="s2">astSyn.txt"</span> <span class="nb">set</span> /p ud <span class="o">=</span> &lt;<span class="s2">"D:</span><span class="se">\A</span><span class="s2">siasoft</span><span class="se">\A</span><span class="s2">E81</span><span class="se">\L</span><span class="s2">astSyn.txt"</span>
	::Thuc hien viec copy
	net use <span class="s2">"</span><span class="se">\\</span><span class="s2">server</span><span class="se">\A</span><span class="s2">siaSoft</span><span class="se">\A</span><span class="s2">E81"</span> password /user:user
	xcopy <span class="s2">"</span><span class="se">\\</span><span class="s2">server</span><span class="se">\A</span><span class="s2">siaSoft</span><span class="se">\A</span><span class="s2">E81"</span> <span class="s2">"D:</span><span class="se">\A</span><span class="s2">siasoft</span><span class="se">\A</span><span class="s2">E81"</span> /D:%ud% /I /Y /E
	::Sau khi copy xong thi luu lai ngay update
	<span class="nb">set </span><span class="nv">ud</span><span class="o">=</span>%m%-%d%-%y%
	<span class="k">if </span>exist <span class="s2">"D:</span><span class="se">\A</span><span class="s2">siasoft</span><span class="se">\A</span><span class="s2">E81</span><span class="se">\L</span><span class="s2">astSyn.txt"</span> del <span class="s2">"D:</span><span class="se">\A</span><span class="s2">siasoft</span><span class="se">\A</span><span class="s2">E81</span><span class="se">\L</span><span class="s2">astSyn.txt"</span>
	<span class="nb">echo</span> %ud% &gt; <span class="s2">"D:</span><span class="se">\A</span><span class="s2">siasoft</span><span class="se">\A</span><span class="s2">E81</span><span class="se">\L</span><span class="s2">astSyn.txt"</span>
	<span class="k">if </span>errorlevel 5 goto writeerror
	<span class="k">if </span>errorlevel 0 goto eof
	:writeerror
	pause Disk write error occurred.
	goto eof
	:GetDate yy mm dd
	setlocal ENABLEEXTENSIONS
	<span class="nb">set </span><span class="nv">t</span><span class="o">=</span>2&amp;if <span class="s2">"%date%z"</span> LSS <span class="s2">"A"</span> <span class="nb">set </span><span class="nv">t</span><span class="o">=</span>1
	<span class="k">for</span> /f <span class="s2">"skip=1 tokens=2-4 delims=(-)"</span> %%a <span class="k">in</span> <span class="o">(</span>‘echo/^|date’<span class="o">)</span> <span class="k">do</span> <span class="o">(</span>
	    <span class="k">for</span> /f <span class="s2">"tokens=%t%-4 delims=.-/ "</span> %%d <span class="k">in</span> <span class="o">(</span>‘date/t’<span class="o">)</span> <span class="k">do</span> <span class="o">(</span>

	    <span class="nb">set</span> %%a<span class="o">=</span>%%d&amp;set %%b<span class="o">=</span>%%e&amp;set %%c<span class="o">=</span>%%f<span class="o">))</span>

	    endlocal&amp;set %1<span class="o">=</span>%yy%&amp;set %2<span class="o">=</span>%mm%&amp;set %3<span class="o">=</span>%dd%&amp;goto :eof

	    :eof

</code></pre>
</div>

    </div>
    </div>
  </article>
  <div class="row">
    <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
       <hr>
<h4>Share this:</h2>
<ul class="share-buttons">
  <li><a href="https://facebook.com/sharer.php?u=http://chungtrinh.com/work/tips%20and%20tricks/2012/04/05/tao-file-batch-dong-bo-2-thu-muc-theo-ngay.html" title="Share on Facebook" target="_blank"><i class="fa fa-facebook fa-fw"></i></a></li>
  <li><a href="https://twitter.com/intent/tweet?text=Tạo file Batch đồng bộ 2 thư mục theo ngày&url=http://chungtrinh.com/work/tips%20and%20tricks/2012/04/05/tao-file-batch-dong-bo-2-thu-muc-theo-ngay.html" target="_blank" title="Tweet"><i class="fa fa-twitter fa-fw"></i></a></li>
  <li><a href="https://plus.google.com/share?url=http://chungtrinh.com/work/tips%20and%20tricks/2012/04/05/tao-file-batch-dong-bo-2-thu-muc-theo-ngay.html" target="_blank" title="Share on Google+"><i class="fa fa-google-plus fa-fw"></i></a></li>
</ul>
<hr>
    </div>
  </div>
  <div class="row">
    <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
      <ul class="pager blog-pager">
        
        <li class="previous">
          <a href="/life/2011/12/10/ve-tau.html" data-toggle="tooltip" data-placement="top" title="Vé tàu">&larr; Previous Post</a>
        </li>
        
        
        <li class="next">
          <a href="/life/2012/04/08/chu-nhat-ca-nha-di-vung-tau.html" data-toggle="tooltip" data-placement="top" title="Chủ nhật cả nhà đi Vũng Tàu">Next Post &rarr;</a>
        </li>
        
      </ul>
    </div>
  </div>

<div class="row disqus-comments">
  <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
    
<div class="comments">
	<div id="disqus_thread"></div>
	<script type="text/javascript">
	    var disqus_shortname = 'chungtrinh';
	    // ensure that pages with query string get the same discussion
            var url_parts = window.location.href.split("?");
            var disqus_url = url_parts[0];	    
	    (function() {
	        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
	        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
	        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
	    })();
	</script>
	<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>


  </div>
</div>

  <!-- 
  <div class="row">
    <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
      <article role="main" class="blog-post">
	      <p>Trong quá trình triển khai phần mềm, việc sửa đổi chương trình theo yêu cầu người dùng là không tránh khỏi. Thường đội triển khai sẽ hiệu chỉnh chương trình trực tiếp trên server và client sẽ update xuống.</p>

<p>Việc update từ server xuống client cũng có nhiều giải pháp. Sau đây là giải pháp mình đang sử dụng:</p>

<p>Giải pháp của mình là sử dụng 1 <a href="http://en.wikipedia.org/wiki/Batch_file">batch file window</a> để thực hiện việc này. Batch file này làm nhiệm vụ copy file từ server về client và chỉ copy những file nào có ngày modify &gt;= ngày update gần nhất. Để xác định ngày update gần nhất mình dùng 1 file text lưu giá trị ngày update.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>	:: Author | Chungtv
	:: Purpose | Synchronize files from server to client
	@echo off
	:: Lay ngay hien tai
	call :GetDate y m d
	<span class="nb">echo </span>TODAY: %m%-%d%-%y%
	<span class="nb">set </span><span class="nv">ud</span><span class="o">=</span>%m%-%d%-%y%
	:: Neu ton tai file update thi gan ngay update la ngay luu trong file
	<span class="k">if </span>exist <span class="s2">"D:</span><span class="se">\A</span><span class="s2">siasoft</span><span class="se">\A</span><span class="s2">E81</span><span class="se">\L</span><span class="s2">astSyn.txt"</span> <span class="nb">set</span> /p ud <span class="o">=</span> &lt;<span class="s2">"D:</span><span class="se">\A</span><span class="s2">siasoft</span><span class="se">\A</span><span class="s2">E81</span><span class="se">\L</span><span class="s2">astSyn.txt"</span>
	::Thuc hien viec copy
	net use <span class="s2">"</span><span class="se">\\</span><span class="s2">server</span><span class="se">\A</span><span class="s2">siaSoft</span><span class="se">\A</span><span class="s2">E81"</span> password /user:user
	xcopy <span class="s2">"</span><span class="se">\\</span><span class="s2">server</span><span class="se">\A</span><span class="s2">siaSoft</span><span class="se">\A</span><span class="s2">E81"</span> <span class="s2">"D:</span><span class="se">\A</span><span class="s2">siasoft</span><span class="se">\A</span><span class="s2">E81"</span> /D:%ud% /I /Y /E
	::Sau khi copy xong thi luu lai ngay update
	<span class="nb">set </span><span class="nv">ud</span><span class="o">=</span>%m%-%d%-%y%
	<span class="k">if </span>exist <span class="s2">"D:</span><span class="se">\A</span><span class="s2">siasoft</span><span class="se">\A</span><span class="s2">E81</span><span class="se">\L</span><span class="s2">astSyn.txt"</span> del <span class="s2">"D:</span><span class="se">\A</span><span class="s2">siasoft</span><span class="se">\A</span><span class="s2">E81</span><span class="se">\L</span><span class="s2">astSyn.txt"</span>
	<span class="nb">echo</span> %ud% &gt; <span class="s2">"D:</span><span class="se">\A</span><span class="s2">siasoft</span><span class="se">\A</span><span class="s2">E81</span><span class="se">\L</span><span class="s2">astSyn.txt"</span>
	<span class="k">if </span>errorlevel 5 goto writeerror
	<span class="k">if </span>errorlevel 0 goto eof
	:writeerror
	pause Disk write error occurred.
	goto eof
	:GetDate yy mm dd
	setlocal ENABLEEXTENSIONS
	<span class="nb">set </span><span class="nv">t</span><span class="o">=</span>2&amp;if <span class="s2">"%date%z"</span> LSS <span class="s2">"A"</span> <span class="nb">set </span><span class="nv">t</span><span class="o">=</span>1
	<span class="k">for</span> /f <span class="s2">"skip=1 tokens=2-4 delims=(-)"</span> %%a <span class="k">in</span> <span class="o">(</span>‘echo/^|date’<span class="o">)</span> <span class="k">do</span> <span class="o">(</span>
	    <span class="k">for</span> /f <span class="s2">"tokens=%t%-4 delims=.-/ "</span> %%d <span class="k">in</span> <span class="o">(</span>‘date/t’<span class="o">)</span> <span class="k">do</span> <span class="o">(</span>

	    <span class="nb">set</span> %%a<span class="o">=</span>%%d&amp;set %%b<span class="o">=</span>%%e&amp;set %%c<span class="o">=</span>%%f<span class="o">))</span>

	    endlocal&amp;set %1<span class="o">=</span>%yy%&amp;set %2<span class="o">=</span>%mm%&amp;set %3<span class="o">=</span>%dd%&amp;goto :eof

	    :eof

</code></pre>
</div>

	    </article>
	  	  
      <ul class="pager blog-pager">
        
        <li class="previous">
          <a href="/life/2011/12/10/ve-tau.html" data-toggle="tooltip" data-placement="top" title="Vé tàu">&larr; Previous Post</a>
        </li>
        
        
        <li class="next">
          <a href="/life/2012/04/08/chu-nhat-ca-nha-di-vung-tau.html" data-toggle="tooltip" data-placement="top" title="Chủ nhật cả nhà đi Vũng Tàu">Next Post &rarr;</a>
        </li>
        
      </ul>
      
	    
        <div class="disqus-comments">
	        
<div class="comments">
	<div id="disqus_thread"></div>
	<script type="text/javascript">
	    var disqus_shortname = 'chungtrinh';
	    // ensure that pages with query string get the same discussion
            var url_parts = window.location.href.split("?");
            var disqus_url = url_parts[0];	    
	    (function() {
	        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
	        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
	        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
	    })();
	</script>
	<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>


        </div>
	    
    </div>
  </div> -->
</div>


    <footer>
  <div class="container beautiful-jekyll-footer">
    <div class="row">
      <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
        <ul class="list-inline text-center footer-links">
          
          <li>
            <a href="https://www.facebook.com/chungtv" title="Facebook" target="_blank">
              <span class="fa-stack fa-lg">
                <i class="fa fa-circle fa-stack-2x"></i>
                <i class="fa fa-facebook fa-stack-1x fa-inverse"></i>
              </span>
            </a>
          </li>
          
          
          <li>
            <a href="https://github.com/chungtv" title="GitHub" target="_blank">
              <span class="fa-stack fa-lg">
                <i class="fa fa-circle fa-stack-2x"></i>
                <i class="fa fa-github fa-stack-1x fa-inverse"></i>
              </span>
            </a>
          </li>
          
		  
          <li>
            <a href="https://twitter.com/trinhvanchung" title="Twitter" target="_blank">
              <span class="fa-stack fa-lg">
                <i class="fa fa-circle fa-stack-2x"></i>
                <i class="fa fa-twitter fa-stack-1x fa-inverse"></i>
              </span>
            </a>
          </li>
          
		  
          <li>
            <a href="mailto:aschungtv@gmail.com" title="Email me">
              <span class="fa-stack fa-lg">
                <i class="fa fa-circle fa-stack-2x"></i>
                <i class="fa fa-envelope fa-stack-1x fa-inverse"></i>
              </span>
            </a>
          </li>
          
		  
		  
		  
		  <li>
			<a href="/feed.xml" title="RSS" target="_blank">
			  <span class="fa-stack fa-lg">
				<i class="fa fa-circle fa-stack-2x"></i>
				<i class="fa fa-rss fa-stack-1x fa-inverse"></i>
			  </span>
			</a>
		  </li>		
          		  
        </ul>
        <p class="copyright text-muted">
		  Chung Trịnh
		  &nbsp;&bull;&nbsp;
		  2016
		  
		  
		  &nbsp;&bull;&nbsp;
		  <a href="http://chungtrinh.com">chungtrinh.com</a>
		  
	    </p>
	        <!-- Please don't remove this, keep my open source work credited :) -->
		<p class="theme-by text-muted">
		  Theme by
		  <a href="http://deanattali.com/beautiful-jekyll/"  target="_blank">beautiful-jekyll</a>
		</p>
      </div>
    </div>
  </div>
</footer>

  
    <!-- everything has to be repeated twice because on 2016-02-01 GitHub pages migrated to jekyll 3; see bug https://github.com/jekyll/jekyll/issues/4439 -->











  
    <!-- doing something a bit funky here because I want to be careful not to include JQuery twice! -->
    
      <script>
      	if (typeof jQuery == 'undefined') {
      	  document.write('<script src="/js/jquery-1.11.2.min.js"></scr' + 'ipt>');
      	}
      </script>
    
  
    <!-- doing something a bit funky here because I want to be careful not to include JQuery twice! -->
    
	<script src="/js/bootstrap.min.js"></script>
    
  
    <!-- doing something a bit funky here because I want to be careful not to include JQuery twice! -->
    
	<script src="/js/main.js"></script>
    
  




	<!-- Google Analytics -->
	<script>
		(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
		(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
		m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
		})(window,document,'script','//www.google-analytics.com/analytics.js','ga');
		ga('create', 'UA-62079859-1', 'auto');
		ga('send', 'pageview');
	</script>
	<!-- End Google Analytics -->


  
  </body>
</html>
